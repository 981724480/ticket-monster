<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html>
<head>
    <title>Ticket Monster</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="resources/css/screen.css"/>

    <script type="text/javascript" src="resources/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="resources/js/underscore-min.js"></script>
    <script type="text/javascript" src="resources/js/backbone-min.js"></script>


</head>
<body>
<div id="container">
    <a href="#">Home</a>
    <a href="#a">Elsewhere</a>
</div>
<div id="container2">
    <a href="#">Home</a>
    <a href="#a">Elsewhere</a>
</div>
<footer>
    <img src="resources/gfx/logo.png" alt="HTML5"/>
</footer>
<script type="text/javascript">
    TicketMonster = new Object()
    TicketMonster.views = new Object()
    TicketMonster.models = new Object()

    TicketMonster.Event = Backbone.Model.extend({
        initialize: function() {
            console.log("Creating an event")
        }
    })

    TicketMonster.Events = Backbone.Collection.extend ({
       url : "rest/events",
       model: TicketMonster.Event,

    });

    TicketMonster.MainView = Backbone.View.extend({

        render: function() {
            console.log("Beginning to render")
            console.log(JSON.stringify(TicketMonster.models.events.models))
            $(this.el).empty().append("<div id='events'/>");
            _.each(TicketMonster.models.events.models, function(model){
                    $("#events").append(model.get('name'))
            })
            console.log("Ending render")
            return this;
        }
    });

    TicketMonster.Router = Backbone.Router.extend({
        routes:{
            "":"home",
            "*actions":"defaultHandler"
        },
        initialize: function() {
            TicketMonster.views.mainView = new TicketMonster.MainView({el:$("#container")})
            TicketMonster.models.events = new TicketMonster.Events;
            TicketMonster.models.events.bind("reset", function(){alert("refreshed"); TicketMonster.views.mainView.render()})
        },
        home:function () {
            TicketMonster.models.events.fetch()
        },
        defaultHandler: function(actions) {
            alert(actions)
        }
    });


    var tmRouter = new TicketMonster.Router;

    Backbone.history.start();
</script>
</body>
</html>